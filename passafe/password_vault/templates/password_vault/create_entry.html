{% extends "base.html" %}

{% block title %}Create Password Entry - PasSafe{% endblock %}

{% block content %}
{% load static %}
<div class="container mt-5">
    <h2 class="text-center mb-4">
        Create Password Entry 
        {% if is_grouped %} <strong>in {{ folder.name }}</strong>{% endif %}
    </h2>

    <!-- Messages -->
    {% if messages %}
    <div class="alert alert-info shadow-sm">
        {% for message in messages %}
            {% if "create_entry" in message.tags %}
                <p>{{ message }}</p>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Form Section -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="box shadow-sm p-4">
                <form method="post">
                    {% csrf_token %}

                    <!-- Title Field -->
                    <div class="mb-3">
                        <label for="id_title" class="form-label">Title</label>
                        {{ form.title }}
                    </div>

                    <!-- Username Field -->
                    <div class="mb-3">
                        <label for="id_username" class="form-label">Username</label>
                        {{ form.username }}
                    </div>

                    <!-- Password Field -->
                    <div class="mb-3">
                        <label for="id_password_entry" class="form-label">Password</label>
                        <div class="input-group">
                            {{ form.password_entry }}
                            <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#passwordGeneratorModal">
                                <i class="fas fa-key"></i>
                            </button>
                        </div>
                    </div>

                    <!-- URL Field -->
                    <div class="mb-3">
                        <label for="id_url" class="form-label">URL</label>
                        {{ form.url }}
                    </div>

                    <!-- Notes Field -->
                    <div class="mb-3">
                        <label for="id_notes" class="form-label">Notes</label>
                        {{ form.notes }}
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary px-4">Save Entry</button>
                    </div>
                </form>
            </div>

            <!-- Back to Dashboard Button -->
            <div class="text-center mt-3">
                <a href="{% url 'password_vault:vault_dashboard' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Password Generator Modal -->
<div class="modal fade" id="passwordGeneratorModal" tabindex="-1" aria-labelledby="passwordGeneratorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content shadow-lg">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="passwordGeneratorModalLabel">
                    <i class="fas fa-key me-2"></i> Password Generator
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body bg-light">
                <form id="password-generator-form">
                    {% csrf_token %}

                    <!-- Length Input -->
                    <div class="mb-3">
                        <label for="password-length" class="form-label">
                            <i class="fas fa-arrows-alt-h me-2"></i> Password Length
                        </label>
                        <input 
                            type="number" 
                            class="form-control shadow-sm" 
                            id="password-length" 
                            name="length" 
                            value="12" 
                            min="8" 
                            max="64" 
                            required
                        >
                    </div>

                    <!-- Character Types -->
                    <label class="form-label">
                        <i class="fas fa-cogs me-2"></i> Character Types
                    </label>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            id="include-uppercase" 
                            name="include_uppercase" 
                            checked
                        >
                        <label class="form-check-label" for="include-uppercase">A-Z (Uppercase Letters)</label>
                    </div>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            id="include-lowercase" 
                            name="include_lowercase" 
                            checked
                        >
                        <label class="form-check-label" for="include-lowercase">a-z (Lowercase Letters)</label>
                    </div>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            id="include-numbers" 
                            name="include_numbers" 
                            checked
                        >
                        <label class="form-check-label" for="include-numbers">0-9 (Numbers)</label>
                    </div>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            id="include-symbols" 
                            name="include_symbols"
                        >
                        <label class="form-check-label" for="include-symbols">Symbols (!@#$...)</label>
                    </div>

                    <!-- Generate Password Button -->
                    <div class="text-center mt-4">
                        <button type="button" class="btn btn-success" onclick="generatePassword()">
                            <i class="fas fa-magic me-2"></i> Generate Password
                        </button>
                    </div>
                </form>

                <!-- Generated Password -->
                <div class="mt-4">
                    <h5 class="mb-3 text-center">
                        <i class="fas fa-lock-open me-2"></i> Generated Password
                    </h5>
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="generated-password" 
                            class="form-control shadow-sm" 
                            readonly
                        >
                        <button type="button" class="btn btn-outline-secondary" onclick="copyToClipboard()">
                            <i class="fas fa-copy me-2"></i> Copy
                        </button>
                    </div>
                    <div id="copy-message" class="mt-2 text-success text-center" style="display: none;">
                        <i class="fas fa-check-circle me-2"></i> Password copied to clipboard!
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Close
                </button>
            </div>
        </div>
    </div>
</div>


<script src="{% static 'password_generator/js/generate_password.js' %}"></script>
<script src="{% static 'password_generator/js/copy_password.js' %}"></script>
{% endblock %}
